---
# ./libs/undeploy-load-balancer.yml

- name: Reverse Deploy Load balancer on frontend hosts
  hosts: frontends
  gather_facts: false # remove later! speeds up testing
  become: true
  vars_files:
    - ../vars/variables.yml

  tasks:
    - name: Reverse Start Load balancer
      service:
        name: "{{ load_balancer_service }}"
        state: stopped

    - name: Reverse Enable Load balancer at boot
      service:
        name: "{{ load_balancer_service }}"
        enabled: no

    - name: Reverse Configure Load balancer
      file:
        path: /etc/haproxy/haproxy.cfg
        state: absent

    - name: Reverse Install Load balancer
      yum:
        name: "{{ load_balancer_service }}"
        state: absent