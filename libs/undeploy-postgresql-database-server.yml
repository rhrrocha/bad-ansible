---
# ./libs/undeploy-postgresql-database-server.yml

- name: Revert Deploy Postgres
  hosts: appdbs
  become: true
  vars_files:
    - ../vars/variables.yml

  tasks:
    - name: Revert Start Postgres
      service:
        name: postgresql.service
        state: stopped

    - name: Check if PostgreSQL Database is Initialized
      stat:
        path: "{{ postgres_data_dir_path }}/PG_VERSION"
      register: postgres_initialized

    - name: Revert Initilize Postgres
      when: postgres_initialized.stat.exists
      path: "{{ postgres_data_dir_path }}/PG_VERSION"
      state: absent

    - name: Revert Enable Postgres at Boot
      service:
        name: postgresql
        enabled: no

    - name: Revert Install Postgres
      yum:
        name: postgresql-server
        state: absent