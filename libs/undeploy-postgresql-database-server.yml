---
# ./libs/undeploy-postgresql-database-server.yml

- name: Reverse Deploy Postgres
  hosts: appdbs
  become: true
  vars_files:
    - ../vars/variables.yml

  tasks:
    - name: Reverse Start Postgres
      service:
        name: postgresql.service
        state: stopped

    - name: Check if PostgreSQL Database is Initialized
      stat:
        path: "{{ postgres_data_dir_path }}"
      register: postgres_initialized

    - name: Reverse Initilize Postgres
      when: postgres_initialized.stat.exists
      file:
        path: "{{ postgres_data_dir_path }}"
        state: absent

    - name: Reverse Enable Postgres at Boot
      service:
        name: postgresql
        enabled: no

    - name: Reverse Install Postgres
      yum:
        name: postgresql-server
        state: absent